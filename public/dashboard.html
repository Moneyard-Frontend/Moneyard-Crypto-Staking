<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Moneyard Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- User Summary -->
  <section id="user-summary" class="form">
    <h3>Account Summary</h3>
    <p><strong>Username:</strong> <span id="summary-username">Loading...</span></p>
    <p><strong>Total Deposited:</strong> <span id="summary-total">0 USDT</span></p>
    <p><strong>Available Balance:</strong> <span id="summary-balance">0 USDT</span></p>
  </section>

  <!-- Deposit Section -->
  <section id="deposit-section" class="form">
    <h3>Deposit Funds</h3>
    <label for="network">Choose Network:</label>
    <select id="network">
      <option value="TRC20">TRC20 (Tron)</option>
      <option value="BEP20">BEP20 (BNB Smart Chain)</option>
    </select>
    <button onclick="getDepositAddress()">Get Deposit Address</button>
    <p id="deposit-address"></p>

    <input type="number" id="deposit-amount" placeholder="Enter amount (15 - 1000 USDT)" />
    <input type="text" id="txId" placeholder="Enter transaction ID (TxID)" />
    <button onclick="logDeposit()">Submit Deposit</button>
  </section>

  <!-- Withdraw Section -->
  <section id="withdraw-section" class="form">
    <h3>Withdraw Funds</h3>
    <input type="number" id="withdraw-amount" placeholder="Amount to withdraw (USDT)" />
    <input type="text" id="withdraw-address" placeholder="Your USDT wallet address" />
    <input type="password" id="withdraw-password" placeholder="Withdrawal password" />
    <button onclick="submitWithdrawal()">Request Withdrawal</button>
  </section>

  <!-- Earnings Calculator -->
  <section id="earnings-calculator-section" class="form">
    <h3>Earnings Calculator</h3>
    <p>Calculate your daily earnings based on your deposit.</p>
    <input type="number" id="deposit-input" placeholder="Enter deposit amount" />
    <button onclick="calculateEarnings()">Calculate Earnings</button>
    <p id="calculated-earnings"></p>
  </section>

  <!-- Transaction History -->
  <section id="transaction-history-section" class="form">
    <h3>Transaction History</h3>
    <table id="transaction-history-table">
      <thead>
        <tr>
          <th>Type</th>
          <th>Amount</th>
          <th>Network</th>
          <th>Transaction ID</th>
          <th>Status</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        <!-- Transaction rows injected here -->
      </tbody>
    </table>
  </section>

  <script src="script.js"></script>

  <script>
    // Ensure username is loaded from localStorage
    document.getElementById('summary-username').innerText = localStorage.getItem('username') || 'Loading...';

    // Function to load the user summary
    function loadUserSummary() {
      const userId = localStorage.getItem('userId') || 1; // Default to userId 1 for now
      console.log('Fetching user summary for userId:', userId); // Log userId

      fetch(`/user-summary?userId=${userId}`)
        .then(res => res.json())
        .then(data => {
          if (data.totalDeposit !== undefined && data.balance !== undefined) {
            document.getElementById('summary-total').innerText = `${data.totalDeposit.toFixed(2)} USDT`;
            document.getElementById('summary-balance').innerText = `${data.balance.toFixed(2)} USDT`;
          } else {
            alert("Failed to load user summary.");
          }
        })
        .catch(err => {
          console.error("Error loading user summary:", err);
          alert("Failed to load user summary.");
        });
    }

    // Load user summary when the page loads
    loadUserSummary();
  </script>

</body>
</html>

// Admin Panel Script

// Fetch pending withdrawals for the admin
function fetchPendingWithdrawals() {
  fetch('/admin/withdrawals')
    .then(res => res.json())
    .then(data => {
      const withdrawalList = document.getElementById('withdrawal-list');
      withdrawalList.innerHTML = ''; // Clear the current list

      data.withdrawals.forEach(withdrawal => {
        const li = document.createElement('li');
        li.innerHTML = `
          <p>User ID: ${withdrawal.user_id}</p>
          <p>Amount: ${withdrawal.amount} USDT</p>
          <p>Status: ${withdrawal.status}</p>
          <p>Wallet Address: ${withdrawal.wallet_address}</p>
          <button onclick="approveWithdrawal(${withdrawal.id})">Approve</button>
          <button onclick="rejectWithdrawal(${withdrawal.id})">Reject</button>
        `;
        withdrawalList.appendChild(li);
      });
    })
    .catch(err => console.error('Error fetching withdrawals:', err));
}

// Approve withdrawal request
function approveWithdrawal(withdrawalId) {
  fetch('/admin/approve-withdrawal', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ withdrawalId })
  })
    .then(res => res.json())
    .then(data => {
      alert(data.message);
      fetchPendingWithdrawals(); // Refresh the withdrawal list
    })
    .catch(err => {
      console.error('Error approving withdrawal:', err);
      alert('Error approving withdrawal');
    });
}

// Reject withdrawal request
function rejectWithdrawal(withdrawalId) {
  fetch('/admin/reject-withdrawal', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ withdrawalId })
  })
    .then(res => res.json())
    .then(data => {
      alert(data.message);
      fetchPendingWithdrawals(); // Refresh the withdrawal list
    })
    .catch(err => {
      console.error('Error rejecting withdrawal:', err);
      alert('Error rejecting withdrawal');
    });
}

// Fetch transaction history for the admin
function fetchTransactionHistory() {
  fetch('/admin/get-withdrawals')
    .then(res => res.json())
    .then(data => {
      const transactionList = document.getElementById('transaction-history');
      transactionList.innerHTML = ''; // Clear the current list

      data.withdrawals.forEach(transaction => {
        const li = document.createElement('li');
        li.innerHTML = `
          <p>Transaction ID: ${transaction.id}</p>
          <p>User ID: ${transaction.user_id}</p>
          <p>Amount: ${transaction.amount} USDT</p>
          <p>Network: ${transaction.network}</p>
          <p>Transaction Status: ${transaction.status}</p>
          <p>Transaction Date: ${transaction.date}</p>
        `;
        transactionList.appendChild(li);
      });
    })
    .catch(err => console.error('Error fetching transaction history:', err));
}

// Call the function to fetch pending withdrawals and transaction history on page load
document.addEventListener("DOMContentLoaded", function () {
  fetchPendingWithdrawals();
  fetchTransactionHistory();
});

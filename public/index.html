<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Existing head content remains the same -->
</head>
<body>

  <!-- Existing body content remains the same until forms section -->

  <!-- Updated Forms Section -->
  <div id="forms">
    <!-- Sign Up Form (with added email field) -->
    <div id="signup-form" class="form">
      <h2>Sign Up</h2>
      <input type="text" id="signup-username" placeholder="Username" required />
      <input type="email" id="signup-email" placeholder="Email" required />
      <input type="password" id="signup-password" placeholder="Password" required />
      <input type="text" id="signup-refcode" placeholder="Reference Code (optional)" />
      <button onclick="signup()">Sign Up</button>
      <p>Already have an account? <a href="#" onclick="showForm('login-form')">Login</a></p>
    </div>

    <!-- Login Form -->
    <div id="login-form" class="form" style="display: none;">
      <h2>Login</h2>
      <input type="text" id="login-username" placeholder="Username" required />
      <input type="password" id="login-password" placeholder="Password" required />
      <button onclick="login()">Login</button>
      <p><a href="#" onclick="showForm('forgot-password-form')">Forgot password?</a></p>
      <p>Don't have an account? <a href="#" onclick="showForm('signup-form')">Sign Up</a></p>
    </div>

    <!-- New Forgot Password Form -->
    <div id="forgot-password-form" class="form" style="display: none;">
      <h2>Password Recovery</h2>
      <input type="email" id="forgot-email" placeholder="Enter your registered email" required />
      <input type="password" id="new-password" placeholder="New Password" required />
      <input type="password" id="confirm-password" placeholder="Confirm New Password" required />
      <button onclick="resetPassword()">Reset Password</button>
      <p><a href="#" onclick="showForm('login-form')">Back to Login</a></p>
    </div>
  </div>

  <!-- Rest of the existing content remains the same -->

  <!-- Updated JavaScript -->
  <script>
    // Form visibility control
    function showForm(formId) {
      document.getElementById('signup-form').style.display = 'none';
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('forgot-password-form').style.display = 'none';
      document.getElementById(formId).style.display = 'block';
    }

    // Password reset functionality
    function resetPassword() {
      const email = document.getElementById('forgot-email').value;
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;

      if (newPassword !== confirmPassword) {
        alert('Passwords do not match!');
        return;
      }

      let users = JSON.parse(localStorage.getItem('users')) || [];
      const user = users.find(u => u.email === email);

      if (!user) {
        alert('No account found with this email.');
        return;
      }

      user.password = newPassword;
      localStorage.setItem('users', JSON.stringify(users));
      alert('Password updated successfully!');
      showForm('login-form');
    }

    // Update signup function to include email
    function signup() {
      const username = document.getElementById('signup-username').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const refCode = document.getElementById('signup-refcode').value;

      let users = JSON.parse(localStorage.getItem('users')) || [];
      if (users.some(u => u.username === username)) {
        alert('Username already exists!');
        return;
      }
      if (users.some(u => u.email === email)) {
        alert('Email already registered!');
        return;
      }

      users.push({ username, email, password, refCode });
      localStorage.setItem('users', JSON.stringify(users));
      alert('Registration successful! Please login.');
      showForm('login-form');
    }

    // Existing login function (keep your existing implementation)
    function login() {
      // Your existing login implementation
    }
  </script>
</body>
</html>
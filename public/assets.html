<!DOCTYPE html>
<html>
<head>
    <title>Assets - Moneyard</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding-bottom: 100px;
            background: #ffffff;
        }
        .spacer {
            height: 30px;
        }
        .header-buttons {
            display: flex;
            justify-content: space-between;
            margin: 0 20px 25px;
            gap: 10px;
        }
        .header-btn {
            flex: 1;
            padding: 20px;
            font-size: 20px;
            font-weight: bold;
            text-align: left;
            border-radius: 12px;
            border: none;
        }
        .btn-green-blue {
            background: linear-gradient(to right, #28a745, #17a2b8);
            color: white;
        }
        .btn-grey {
            background: #d3d3d3;
            color: #333;
        }
        .btn-dark-green {
            background: #14532d;
            color: white;
        }
        .asset-summary {
            margin: 20px;
            padding: 25px;
            background: #f9f9f9;
            border-radius: 12px;
            text-align: left;
        }
        .asset-summary h3 {
            font-size: 28px;
            margin-bottom: 30px;
            font-weight: bold;
        }
        .summary-item {
            margin: 22px 0;
            font-size: 26px;
            font-weight: bold;
            color: #222;
            text-align: left;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            background: #f1f1f1;
            border-top: 1px solid #ccc;
            padding: 14px 0;
        }
        .nav-btn {
            background: none;
            border: none;
            font-size: 18px;
            font-weight: bold;
            color: #666;
        }
        .nav-btn.active {
            color: #28a745;
        }
        .hidden-section {
            display: none;
            margin: 0 20px 25px;
            background: #eef2f3;
            border-radius: 12px;
            padding: 20px;
        }
    </style>
</head>
<body>

    <!-- Est. Total Value at the top (dynamically updated) -->
    <div class="asset-summary" style="margin-top: 20px;">
        <div class="summary-item">
            Est. Total Value: <span id="estValue">$0.00</span>
        </div>
    </div>

    <div class="spacer"></div>

    <!-- Header buttons with collapsible sections -->
    <div class="header-buttons">
        <button class="header-btn btn-green-blue" onclick="toggleSection('crypto-content')">Crypto Assets</button>
        <button class="header-btn btn-grey" onclick="toggleSection('savings-content')">High-Yield Savings Account</button>
        <button class="header-btn btn-dark-green" onclick="toggleSection('micro-content')">Micro-Investing</button>
    </div>

    <!-- Collapsible Sections -->
    <div class="collapsible-section">
        <div id="crypto-content" class="hidden-section">
            <div class="summary-item">Crypto Wallet Balance: $0.00</div>
            <div class="summary-item">Coins Held: BTC, ETH, USDT</div>
        </div>

        <div id="savings-content" class="hidden-section">
            <div class="summary-item">Interest Rate: 8% APY</div>
            <div class="summary-item">Savings Balance: $0.00</div>
        </div>

        <div id="micro-content" class="hidden-section">
            <div class="summary-item">Portfolio: Round-up Investments</div>
            <div class="summary-item">Current Value: $0.00</div>
        </div>
    </div>

    <!-- Wallet Overview Section (dynamic fields) -->
    <div class="asset-summary">
        <h3>Wallet Overview</h3>
        <div class="summary-item">Total Deposits: <span id="totalDeposits">$0.00</span></div>
        <div class="summary-item">Total Earnings: <span id="totalEarnings">$0.00</span></div>
        <div class="summary-item">Pending Withdrawals: <span id="pendingWithdrawals">$0.00</span></div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn" onclick="navigateTo('home')">Home</button>
        <button class="nav-btn" onclick="navigateTo('referral')">Referral</button>
        <button class="nav-btn" onclick="navigateTo('stake')">Stake</button>
        <button class="nav-btn" onclick="navigateTo('withdraw')">Withdraw</button>
    </div>

    <script>
        // Toggle collapsible sections
        function toggleSection(id) {
            const sections = ['crypto-content', 'savings-content', 'micro-content'];
            sections.forEach(sectionId => {
                const el = document.getElementById(sectionId);
                if (sectionId === id) {
                    el.style.display = el.style.display === 'block' ? 'none' : 'block';
                } else {
                    el.style.display = 'none';
                }
            });
        }

        // Navigation function
        function navigateTo(page) {
            window.location.href = `${page}.html`;
        }

        // Fetch and update the asset summary for the user
        document.addEventListener('DOMContentLoaded', () => {
            const userId = 1; // Replace with actual user ID logic

            // Fetch data from the backend API for user assets
            fetch(`/user/assets-summary?userId=${userId}`)
                .then(response => response.json())
                .then(data => {
                    // Update the DOM elements with fetched data
                    document.getElementById('estValue').innerText = `$${data.totalValue.toFixed(2)}`;
                    document.getElementById('totalDeposits').innerText = `$${data.totalDeposits.toFixed(2)}`;
                    document.getElementById('totalEarnings').innerText = `$${data.earnings.toFixed(2)}`;
                    document.getElementById('pendingWithdrawals').innerText = `$${data.pendingWithdrawals.toFixed(2)}`;
                })
                .catch(err => console.error('Failed to load asset summary', err));
        });
    </script>

</body>
</html>

    }

    .footer-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #f9f9f9;
      display: flex;
      justify-content: space-between;
      padding: 10px 15px;
      border-top: 1px solid #ccc;
    }

    .footer-nav button {
      flex: 1;
      margin: 0 5px;
      padding: 12px 0;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 15px;
    }

    .deposit-btn {
      background-color: #28a745;
      color: white;
    }

    .withdraw-btn {
      background-color: #006400;
      color: white;
    }

    .transfer-btn {
      background-color: #999;
      color: white;
    }

    .tab-content {
      display: none;
      padding: 20px;
    }

    .tab-content.active {
      display: block;
    }

    .tab-content h3 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <div class="header-buttons">
    <button class="left-button">Crypto Assets</button>
    <button class="center-button">High-Yield Savings Account</button>
    <button class="right-button">Micro-Investing</button>
  </div>

  <div class="assets-overview">
    <h2>Est. Total Value</h2>
    <div id="totalValue" style="font-size: 24px; color: #28a745;">$0</div>
  </div>

  <div class="overview-section">
    <div class="asset-box">
      <div class="asset-title">Crypto Assets</div>
      <div class="asset-value" id="cryptoAssetsValue">$0</div>
    </div>

    <div class="asset-box">
      <div class="asset-title">High-Yield Savings Account</div>
      <div class="asset-value" id="savingsValue">$0</div>
    </div>

    <div class="asset-box">
      <div class="asset-title">Micro-Investing</div>
      <div class="asset-value" id="microInvestingValue">$0</div>
    </div>
  </div>

  <!-- Dynamic Tab Contents -->
  <div id="depositTab" class="tab-content active">
    <h3>Deposit Funds</h3>
    <p>Select network and enter amount...</p>
  </div>

  <div id="withdrawTab" class="tab-content">
    <h3>Withdraw Funds</h3>
    <p>Enter amount, wallet address and verify...</p>
  </div>

  <div id="transferTab" class="tab-content">
    <h3>Transfer Funds</h3>
    <p>Transfer between assets or to another user...</p>
  </div>

  <!-- Footer Navigation -->
  <div class="footer-nav">
    <button class="deposit-btn" onclick="showTab('depositTab')">Deposit</button>
    <button class="withdraw-btn" onclick="showTab('withdrawTab')">Withdraw</button>
    <button class="transfer-btn" onclick="showTab('transferTab')">Transfer</button>
  </div>

  <script>
    // Dummy data - replace with API values if needed
    const cryptoAssets = 500;
    const highYieldSavings = 300;
    const microInvesting = 150;

    document.getElementById('cryptoAssetsValue').textContent = `$${cryptoAssets}`;
    document.getElementById('savingsValue').textContent = `$${highYieldSavings}`;
    document.getElementById('microInvestingValue').textContent = `$${microInvesting}`;
    document.getElementById('totalValue').textContent = `$${cryptoAssets + highYieldSavings + microInvesting}`;

    // Tab switching
    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.getElementById(tabId).classList.add('active');
    }
  </script>
</body>
</html>

<!-- Add at the bottom inside <body> tag -->
<div class="footer-buttons">
  <button class="footer-btn deposit-btn" onclick="openModal('deposit')">Deposit</button>
  <button class="footer-btn withdraw-btn" onclick="openModal('withdraw')">Withdraw</button>
  <button class="footer-btn transfer-btn" onclick="openModal('transfer')">Transfer</button>
</div>

<!-- Modals -->
<div class="modal" id="depositModal">
  <div class="modal-content">
    <h3>Deposit Funds</h3>
    <form id="depositForm">
      <input type="number" name="amount" placeholder="Amount (USDT)" required />
      <select name="network">
        <option value="TRC20">TRC20</option>
        <option value="BEP20">BEP20</option>
      </select>
      <input type="text" name="txId" placeholder="Transaction ID" required />
      <button type="submit">Submit Deposit</button>
    </form>
  </div>
</div>

<div class="modal" id="withdrawModal">
  <div class="modal-content">
    <h3>Withdraw Funds</h3>
    <form id="withdrawForm">
      <input type="number" name="amount" placeholder="Amount to withdraw" required />
      <input type="text" name="wallet" placeholder="Wallet Address" required />
      <input type="password" name="password" placeholder="Account Password" required />
      <button type="submit">Submit Withdrawal</button>
    </form>
  </div>
</div>

<div class="modal" id="transferModal">
  <div class="modal-content">
    <h3>Transfer Funds</h3>
    <form id="transferForm">
      <input type="number" name="amount" placeholder="Amount to transfer" required />
      <input type="text" name="recipientId" placeholder="Recipient User ID" required />
      <button type="submit">Submit Transfer</button>
    </form>
  </div>
</div>
<script>
function openModal(type) {
  closeModals();
  document.getElementById(type + 'Modal').style.display = 'block';
}

function closeModals() {
  ['depositModal', 'withdrawModal', 'transferModal'].forEach(id => {
    document.getElementById(id).style.display = 'none';
  });
}

// Deposit logic
document.getElementById("depositForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(this).entries());
  data.userId = 1;

  fetch('/log-deposit', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  }).then(res => res.json()).then(res => {
    alert(res.message || 'Deposit submitted!');
    closeModals();
  });
});

// Withdraw logic
document.getElementById("withdrawForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(this).entries());
  data.userId = 1;

  fetch('/withdraw', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  }).then(res => res.json()).then(res => {
    alert(res.message || 'Withdrawal submitted!');
    closeModals();
  });
});

// Transfer logic
document.getElementById("transferForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(this).entries());
  data.userId = 1;

  fetch('/transfer', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  }).then(res => res.json()).then(res => {
    alert(res.message || 'Transfer complete!');
    closeModals();
  });
});
</script>

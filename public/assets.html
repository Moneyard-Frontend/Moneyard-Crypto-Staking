<!DOCTYPE html>
<html>
<head>
    <title>Assets - Moneyard</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Maintain existing styles */
        .refresh-indicator {
            position: fixed;
            top: 70px;
            right: 20px;
            color: #28a745;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!-- Est. Total Value -->
    <div class="asset-summary" style="margin-top: 20px;">
        <div class="summary-item">
            Est. Total Value: <span id="estValue">$0.00</span>
            <span class="refresh-indicator" id="refreshTime"></span>
        </div>
    </div>

    <!-- Wallet Overview -->
    <div class="asset-summary">
        <h3>Wallet Overview</h3>
        <div class="summary-item">Total Deposits: <span id="totalDeposits">$0.00</span></div>
        <div class="summary-item">Total Earnings: <span id="totalEarnings">$0.00</span></div>
        <div class="summary-item">Pending Withdrawals: <span id="pendingWithdrawals">$0.00</span></div>
    </div>

    <script>
        let lastUpdate = new Date();
        
        function updateDisplay(data) {
            document.getElementById('estValue').textContent = `$${data.totalValue.toFixed(2)}`;
            document.getElementById('totalDeposits').textContent = `$${data.totalDeposits.toFixed(2)}`;
            document.getElementById('totalEarnings').textContent = `$${data.earnings.toFixed(2)}`;
            document.getElementById('pendingWithdrawals').textContent = `$${data.pendingWithdrawals.toFixed(2)}`;
            document.getElementById('refreshTime').textContent = `Updated: ${new Date().toLocaleTimeString()}`;
        }

        async function fetchAssetData() {
            try {
                const userId = localStorage.getItem('userId');
                if (!userId) throw new Error('Not authenticated');

                const response = await fetch(`/user/assets-summary?userId=${userId}`);
                if (!response.ok) throw new Error('Server error');
                
                const data = await response.json();
                updateDisplay(data);
            } catch (error) {
                console.error('Fetch error:', error);
                alert('Error updating balances. Please refresh.');
            }
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            if (!localStorage.getItem('userId')) window.location.href = '/';
            
            fetchAssetData();
            setInterval(fetchAssetData, 30000); // Refresh every 30 seconds
        });
    </script>
</body>
</html>